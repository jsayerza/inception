services:
    redis:
        image: redis:7.2-alpine
        container_name: redis
        restart: unless-stopped
        networks:
            - inception

    ftp:
        container_name: ftp
        build:
            context: ./requirements/ftp
            dockerfile: Dockerfile
        env_file:
            - .env
        volumes:
            - wordpress_data:/var/www/html
        networks:
            - inception
        ports:
            - "21:21"
            - "21000-21010:21000-21010"
        depends_on:
            - wordpress
        restart: unless-stopped

    website:
        container_name: website
        build:
            context: ./requirements/website
            dockerfile: Dockerfile
        networks:
            - inception
        ports:
            - "8080:80"
        restart: unless-stopped

    adminer:
        container_name: adminer
        build:
            context: ./requirements/adminer
            dockerfile: Dockerfile
        networks:
            - inception
        depends_on:
            - mariadb
        restart: unless-stopped

    nginx:
        volumes:
            - ./requirements/nginx/conf/nginx_bonus.conf:/etc/nginx/snippets/adminer.conf:ro


## Notes:
# The override compose file contains only bonus services.
# Docker Compose merges it with the base file, ensuring the mandatory stack remains unchanged.
# Redis runs as an optional bonus service.
# WordPress detects Redis automatically at startup and enables Redis Object Cache only if the Redis service is available.
# If Redis is not running, WordPress falls back transparently to the database.

# wordpress 9000/tcp
# adminer 9000/tcp
# - Each container has its own network namespace
# - Port 9000 is only exposed internally
# - It is not published on the host
# There is no:
#   0.0.0.0:9000->9000
# therefore:
# - There is no binding on the host
# - There is no conflict
# - Nginx is the one who talks to them for Docker internal DNS
